# Workshop: Testing with Fake Data

A workshop demonstrating how to test Python applications using databases in Docker, for ETL and RestAPI purposes. This workshop uses SQLModel for data models, FastAPI for API development, and fake data generated by Factory Boy and Faker. You will need to have Docker preinstalled.

## Learning Objectives

After completing this workshop, you will understand:

- **Factory Boy Patterns** - Generating fake data for testing
- **Database Testing Strategies** - Unit, integration, and Docker-based testing
- **SQLModel & FastAPI Integration** - Modern Python data stack
- **ETL Testing** - Test data transformation and processing flows
- **Test Organization** - Structure tests with pytest markers and fixtures

## Project Structure

```
├── src/
│   ├── app/                       # FastAPI application
│   │   ├── api/
│   │   │   ├── crud/              # CRUD operations
│   │   │   └── routes/            # API routes
│   │   ├── create_app             # FastAPI app factory
│   │   └── main.py                # Application entry point
│   ├── models/
│   │   ├── v1/                    # SQLModel models
│   │   └── faker_models/
│   │       └── db/                # Factory Boy factories
│   ├── etl/                       # ETL processes
│   │   ├── apis/                  # External API clients
│   │   ├── flows/                 # ETL workflows
│   │   └── main.py                # ETL CLI entry point
│   └── shared/                    # Shared utilities
│       ├── engine                 # Database engine
│       └── settings               # Configuration
├── tests/
│   ├── conftest                   # Pytest configuration
│   ├── app/
│   │   ├── conftest               # App test fixtures
│   │   └── api/
│   │       ├── crud/              # CRUD tests
│   │       └── routes/            # Route tests
│   └── etl/
│       ├── conftest               # ETL test fixtures
│       ├── utils                  # Test utilities
│       ├── apis/                  # API client tests
│       └── flows/                 # ETL flow tests
├── db-init-scripts/               # Database initialization
├── .env.dist                      # Environment template
├── compose.yml                    # Docker services
├── pyproject.toml                 # Project dependencies
└── README.md
```

## Quick Start

**Prerequisites**

You need to have Docker installed.

1. UV (package manager)

    Install [UV](https://docs.astral.sh/uv/#installation) also manages your virtual environment and python versions (if needed).

    ```bash
    uv sync --all-groups
    ```

    If you don't use python 3.12 or higher
    ```bash
    uv python install 3.12
    ```

2. Start the database in detached mode

    ```bash
    docker compose up -d
    ```

3. Run tests:
   ```bash
   # Unit tests (no database required)
   pytest -m unit

   # Docker tests (requires database)
   pytest -m docker

   # All tests
   pytest
   ```

4. Run the ETL
   ```bash
   python -m etl.main
   ```

5. Start the API (Optional):
   ```bash
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8080
   ```

### Test Markers
- `@pytest.mark.unit`: Tests that don't require a database
- `@pytest.mark.docker`: Tests that require the Docker database
- `@pytest.mark.integration`: Tests that require external services
