# Workshop: Testing with Fake Data

A comprehensive workshop demonstrating how to test Python applications using databases in Docker with fake data generated by Factory Boy and Faker. This workshop uses SQLModel for data models and FastAPI for API development.

## Learning Objectives

After completing this workshop, you will understand:

- **Factory Boy Patterns** - Generate fake data for testing
- **Database Testing Strategies** - Unit, integration, and Docker-based testing
- **SQLModel & FastAPI Integration** - Modern Python data stack
- **ETL Testing** - Test data transformation and processing flows
- **Test Organization** - Structure tests with pytest markers and fixtures

## Project Structure

```
├── src/workshop/
│   ├── __init__.py
│   ├── api/                    # FastAPI application
│   │   ├── __init__.py
│   │   ├── main.py            # FastAPI app
│   │   ├── deps.py            # Dependencies
│   │   └── routes/            # API routes
│   ├── models/                # SQLModel models
│   │   ├── __init__.py
│   │   └── core.py            # Core models
│   ├── factories/             # Factory Boy factories
│   │   ├── __init__.py
│   │   └── core.py            # Model factories
│   ├── etl/                   # ETL processes
│   │   ├── __init__.py
│   │   └── flows.py           # ETL flows
│   └── core/                  # Core utilities
│       ├── __init__.py
│       ├── database.py        # Database setup
│       └── settings.py        # Configuration
├── tests/
│   ├── conftest.py            # Pytest configuration
│   ├── unit/                  # Unit tests
│   ├── docker/                # Docker-based tests
│   └── integration/           # Integration tests
├── docker-compose.yml         # Docker services
└── README.md
```

## Quick Start

**Prerequisites**

You need to have Docker installed.

1. **UV (package manager)**

    Install [UV](https://docs.astral.sh/uv/#installation) also manages your virtual environment and python versions (if needed).

    ```bash
    uv sync --all-groups
    ```

    If you don't use python 3.12 or higher
    ```bash
    uv python install 3.12
    ```

2. Start the database

    ```bash
    docker compose up postgres -d
    ```

3. **Run tests**:
   ```bash
   # Unit tests (no database required)
   pytest -m unit

   # Docker tests (requires database)
   pytest -m docker

   # All tests
   pytest
   ```

4. **Start the API**:
   ```bash
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8080
   ```

### Test Markers
- `@pytest.mark.unit`: Tests that don't require a database
- `@pytest.mark.docker`: Tests that require the Docker database
- `@pytest.mark.integration`: Tests that require external services

### Factory Patterns
```python
class UserFactory(SQLAlchemyModelFactory):
    class Meta:
        model = User
        sqlalchemy_session_persistence = "commit"

    name = Faker("name")
    email = Faker("email")
```

### Database Testing
```python
def test_user_creation(db_session: Session):
    user = UserFactory()
    assert user.id is not None
    assert "@" in user.email
```
